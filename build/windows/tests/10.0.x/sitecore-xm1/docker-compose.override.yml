version: "2.4"

services:

  mssql:
    image: ${REGISTRY}sitecore-xm1-custom-sxa-jss-mssql:${SITECORE_VERSION}
    volumes:
      - type: bind
        source: .\mssql-data
        target: c:\data

  solr:
    image: ${REGISTRY}sitecore-xm1-custom-sxa-solr:${SITECORE_VERSION}
    volumes:
      - type: bind
        source: .\solr-data
        target: c:\data

  id:
    volumes:
      - ${HOST_LICENSE_FOLDER}:c:\license
    environment:
      SITECORE_LICENSE_LOCATION: c:\license\license.xml

  cm:
    build:
      context: ../build/jss-integrated-mode
      args:
        BASE_IMAGE: ${REGISTRY}sitecore-xm1-custom-sxa-jss-cm:${SITECORE_VERSION}
        NODEJS_VERSION: ${NODEJS_VERSION}
    image: ${REGISTRY}sitecore-xm1-custom-sxa-jss-cm:${SITECORE_VERSION}
    volumes:
      - ${HOST_LICENSE_FOLDER}:c:\license
    environment:
      SITECORE_LICENSE_LOCATION: c:\license\license.xml

  cd:
    build:
      context: ../build/jss-integrated-mode
      args:
        BASE_IMAGE: ${REGISTRY}sitecore-xm1-custom-sxa-jss-cd:${SITECORE_VERSION}
        NODEJS_VERSION: ${NODEJS_VERSION}
    image: ${REGISTRY}sitecore-xm1-custom-sxa-jss-cd:${SITECORE_VERSION}
    volumes:
      - ${HOST_LICENSE_FOLDER}:c:\license
    environment:
      SITECORE_LICENSE_LOCATION: c:\license\license.xml